---
import DesktopMenu from './DesktopMenu.astro';
import Logo from './Logo.astro';
import MobileMenu from './MobileMenu.astro';
import MobileMenuButton from './MobileMenuButton.astro';
import ThemeToggle from './ThemeToggle.astro';

const { pathname } = Astro.url;
const currentPath = pathname.replace(/\/$/, '') || '/';

const links = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
].map((link) => ({
  ...link,
  isActive: link.href === '/' ? currentPath === '/' : currentPath.startsWith(link.href),
}));
---

<header
  class="sticky top-0 z-50 w-full bg-background/95 backdrop-blur-sm border-b border-border transition-colors duration-200"
>
  <div
    class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 relative flex h-16 items-center justify-between"
  >
    <div class="flex items-center gap-8">
      <a href="/" aria-label="Home" class="flex items-center gap-3">
        <Logo size={48} class="text-primary" />
        <span class="text-lg font-bold text-foreground hidden sm:block"
          >Olly Nevard</span
        >
      </a>
      <DesktopMenu links={links} />
    </div>

    <div class="flex items-center gap-4">
      <ThemeToggle />
      <MobileMenuButton />
    </div>
  </div>

  <MobileMenu links={links} />
</header>

<script>
  function setupMobileMenu() {
    const button = document.getElementById("mobile-menu-button");
    const menu = document.getElementById("mobile-menu");

    if (button && menu) {
      button.onclick = () => {
        const expanded = button.getAttribute("aria-expanded") === "true";
        button.setAttribute("aria-expanded", String(!expanded));
        menu.classList.toggle("hidden");
      };
    }
  }

  setupMobileMenu();
  document.addEventListener("astro:after-swap", setupMobileMenu);
</script>
