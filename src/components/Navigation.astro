---
import CloseIcon from './icons/CloseIcon.astro';
import MenuIcon from './icons/MenuIcon.astro';

const { pathname } = Astro.url;
const currentPath = pathname.replace(/\/$/, '') || '/';

const links = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
].map((link) => ({
  ...link,
  isActive: link.href === '/' ? currentPath === '/' : `${currentPath.startsWith(link.href)}/`,
}));
---

<!-- Desktop Navigation -->
<nav class="hidden sm:flex items-center gap-6">
    {
        links.map((link) => (
            <a
                href={link.href}
                class:list={[
                    "text-sm font-medium transition-colors",
                    link.isActive
                        ? "text-ctp-mauve font-bold"
                        : "text-ctp-subtext0 hover:text-ctp-text",
                ]}
                aria-current={link.isActive ? "page" : undefined}
            >
                {link.label}
            </a>
        ))
    }
</nav>

<!-- Mobile Menu Button -->
<button
    id="mobile-menu-button"
    type="button"
    class="sm:hidden text-ctp-subtext0 hover:text-ctp-text cursor-pointer"
    aria-label="Open menu"
>
    <MenuIcon />
</button>

<!-- Mobile Menu Drawer -->
<div
    id="mobile-menu"
    class="bg-ctp-base h-screen fixed inset-0 z-50 transform transition-transform duration-300 translate-x-full sm:hidden"
>
    <div class="absolute inset-0 bg-ctp-base"></div>
    <div class="relative flex h-full flex-col p-6">
        <div class="flex items-center justify-end mb-8">
            <button
                id="close-menu-button"
                type="button"
                class="p-2 text-ctp-subtext0 hover:text-ctp-text cursor-pointer"
                aria-label="Close menu"
            >
                <CloseIcon />
            </button>
        </div>
        <nav class="flex flex-col gap-6 text-center">
            {
                links.map((link) => (
                    <a
                        href={link.href}
                        class:list={[
                            "text-xl font-medium transition-colors",
                            link.isActive
                                ? "text-ctp-mauve font-bold"
                                : "text-ctp-subtext0 hover:text-ctp-text",
                        ]}
                        aria-current={link.isActive ? "page" : undefined}
                    >
                        {link.label}
                    </a>
                ))
            }
        </nav>
    </div>
</div>

<script>
    const setupMobileMenu = () => {
        const menuButton = document.getElementById("mobile-menu-button");
        const closeMenuButton = document.getElementById("close-menu-button");
        const menu = document.getElementById("mobile-menu");

        if (!menuButton || !closeMenuButton || !menu) return;

        const toggleMenu = () => {
            const isClosed = menu.classList.contains("translate-x-full");
            if (isClosed) {
                menu.classList.remove("translate-x-full");
                document.body.style.overflow = "hidden";
            } else {
                menu.classList.add("translate-x-full");
                document.body.style.overflow = "";
            }
        };

        menuButton.onclick = toggleMenu;
        closeMenuButton.onclick = toggleMenu;
    };

    document.addEventListener("astro:page-load", setupMobileMenu);
</script>
